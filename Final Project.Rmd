---
title: "Armed Conflict Final Project"
author: "Ghada Amer"
date: "October 19, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)

library(tidyverse)
library(stringr)
library(ggplot2)
library(kableExtra)
library(rebus)
library(lubridate)
library(knitr)
library(haven)
library(formattable)
library(janitor)
library(purrr)
library(fs)
library(readr)
library(dplyr)
library(scales)
library(shiny)
library(devtools)
library(maps)
library(mapdata)
library(rvest)
library(magrittr)
library(ggmap)
library(devtools)
library(plotly)
library(countrycode)
library(leaflet)



data <- read_csv("ged181.csv")


```

```{r Clean Data}

  ## In this chunk, I started cleaning the data by selecting
  ## the variables I plan to use in my app. I removed all 
  ## source-related variables and numeric country code schemes
  ## as they are not relevant for the purposes of my project. I 
  ## also chose to use the average estimate of total deaths 
  ## instead of the lowest or highest estimates to provide more
  ## accurate results. I recoded the type of violence values from 
  ## a numeric code into value labels. 

clean_data <-
  data %>% 
  select(-contains("source"), -low, -high, -contains("gwno")) %>% 
  rename(total_deaths = best) %>% 
  mutate(type_of_violence = case_when(
        type_of_violence == "1" ~ "state-based conflict",
        type_of_violence == "2" ~ "non-state conflict",
        type_of_violence == "3" ~ "one-sided violence")) 
  

```


```{r}

total_percentages <-
  clean_data %>% 
  mutate(total_conflicts = n_distinct(id)) %>% 
  group_by(region, total_conflicts) %>% 
  count() %>% 
  mutate(percentage_conflicts = n/total_conflicts*100) %>% 
  ungroup() %>% 
  select(region, percentage_conflicts)

total_percentages_2 <-
  clean_data %>%
  group_by(region) %>% 
  summarize(death_per_region = sum(total_deaths))

joined_data <- inner_join(total_percentages, total_percentages_2, by = "region")

total_deaths_over_time <-
  clean_data %>% 
  group_by(year, type_of_violence) %>% 
  summarize(total_deaths = sum(total_deaths))

```

```{r}

point <- format_format(big.mark = "," , scientific = FALSE)


total_deaths_over_time %>% 
  ggplot(aes(x = year, y = total_deaths, colour = type_of_violence)) +
  geom_line() + 
  geom_point(alpha = 0.8, size = 2) +
  scale_y_continuous(labels = point) +
  theme_dark() + 
      labs(title = "Annual Deaths Over Time ",
           subtitle = "by Type of Violence",
           x = "Year",
           y = "Number of Deaths",
           color = "Type of Violence") + 
      theme(title = element_text(size = 14, face = "bold"),
            legend.text = element_text(size = 12, colour = "black"),
            legend.key = element_rect(fill = "white"),
            legend.title = element_text(face = "bold", size = 12),
            legend.justification = c("right", "top"),
            legend.position = "right",
            axis.title.x = element_text(size = 14, vjust = -0.4), 
            axis.title.y = element_text(size = 14, vjust = 0.4)) +
      scale_color_manual("Type of Violence", values = c("State-Based Conflict" = "orange", 
                                                     "Non-State Conflict" = "darkred", 
                                                     "One-Sided Violence" = "lightpink"))

```


```{r}

map_data <-
  clean_data %>% 
  distinct(conflict_id, .keep_all = TRUE)

red_icon <- makeIcon(
  iconUrl = "http://icons.iconarchive.com/icons/paomedia/small-n-flat/24/map-marker-icon.png",
  iconWidth = 24, iconHeight = 26,
  iconAnchorX = 22, iconAnchorY = 94,
  shadowUrl = "http://leafletjs.com/examples/custom-icons/leaf-shadow.png",
  shadowWidth = 50, shadowHeight = 64,
  shadowAnchorX = 4, shadowAnchorY = 62)

leaflet(options = leafletOptions(minZoom = 1)) %>% 
  addProviderTiles("CartoDB.DarkMatter") %>% 
  setMaxBounds(lng1 = 180 , lat1 = 90, lng2 = -180, lat2 = -90) %>% 
  addMarkers(lng = map_data$longitude, lat = map_data$latitude,
             icon = red_icon, 
             label = paste0("The conflict involved ", map_data$conflict_name, "."," ",
                            "It started in ", map_data$year, ".", " ",
                            "It consisted of ",  map_data$type_of_violence, "."," ",
                            "Total number of deaths: ", map_data$total_deaths," ", "."),
             clusterOptions = markerClusterOptions(),
             labelOptions = labelOptions(noHide = F, 
                                         textsize = "10px", 
                                         direction = "bottom"))

```



